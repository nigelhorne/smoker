#!/usr/bin/env bash

# Run this every hour via cron

# Doesn't work on OS/X or Dragonfly
# https://unix.stackexchange.com/questions/102691/get-age-of-given-file

function fileAge {
        local fileMod
        if fileMod=$(stat -c %Y -- "$1")
        then
                echo $(( $(date +%s) - $fileMod ))
        else
                return $?
        fi
}

typeset -r age=$(fileAge $HOME/.cpanreporter/reports-sent.db)

if (( $age > 7200 )); then
	logger 'reports-sent.db is old: check system is testing CPAN'
	echo 'reports-sent.db is old: check system is testing CPAN' |
		mail -s 'Check CPAN' root
fi
