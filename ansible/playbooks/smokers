---
- hosts: smokers
  remote_user: njh

  pre_tasks:
  - name: Only runs on RedHat
    fail:
      msg: Only runs on RedHat
    when:
      ansible_facts['os_family'] != "RedHat"
  # - name: set installer
    # set_fact:
      # dnf: "{{ 'yum' if ansible_facts['distribution_major_version'] <= '7' else 'dnf' }}"

  tasks:
  # - name: what
    # debug: msg="{{ dnf }}"
  - name: upgrade all packages
    package:
      name: '*'
      state: latest
    become: yes
    become_method: sudo
  - name: install CPAN smoking stuff
    package:
      name:
        - gcc-c++
        - curl
        - wget
        - perl-Proc-ProcessTable
        - autoconf
        - automake
        - expat-devel
        - git
        - rsync
        - tar
        - patch
        - cpan
        - bzip2
        - openssl-devel
        - gtk2-devel
        - libaio-devel
        - libcap-devel
        - libattr-devel
        - flex
        - bison
        # - lynx
        - ncurses-devel
        - perl-autodie
        - perl-CPAN
        - perl-version
        - perl-Pod-Perldoc
        # - perlbrew
        - sqlite
        - yum-utils
        # - deltarpm
      state: present
      # become: yes
      # become_method: sudo
