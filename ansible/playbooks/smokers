---
# Probably a few too many modules here as it may include stuff not needed
# for CPAN testing that I need to take out
- hosts: smokers
  remote_user: njh

  # pre_tasks:
  # - name: Only runs on RedHat
    # fail:
      # msg: Only runs on RedHat
    # when:
      # ansible_facts['os_family'] != "RedHat"

  tasks:
  - name: upgrade all packages
    package:
      name: '*'
      state: latest
    become: yes
  - name: install CPAN smoking stuff on all machines
    package:
      state: present
      name:
        - curl
        - wget
        - autoconf
        - automake
        - git
        - rsync
        - tar
        - patch
        - bzip2
        - flex
        - bison
        # - lynx
        # - perlbrew
        - sqlite
    become: yes
  - name: install CPAN smoking stuff on RedHat
    package:
      state: present
      name:
        - cpan
        - expat-devel
        - gcc-c++
        - gtk2-devel
        - libaio-devel
        - libattr-devel
        - libcap-devel
        - ncurses-devel
        - openssl-devel
        - yum-utils
        # - deltarpm
        - perl-autodie
        - perl-CPAN
        - perl-Pod-Perldoc
        - perl-Proc-ProcessTable
        - perl-version
    when:
      ansible_facts['os_family'] == 'RedHat'
    become: yes
  - name: install CPAN smoking stuff on Debian
    package:
      state: present
      name:
        - gcc
        - libaio-dev
        - libattr1-dev
        - libcap-dev
        - libexpat1-dev
        - libgtk2.0-dev
        - libncurses-dev
        - libperl-version-perl
        - libproc-processtable-perl
        - libssl-dev
    when:
      ansible_facts['os_family'] == 'Debian'
    become: yes
